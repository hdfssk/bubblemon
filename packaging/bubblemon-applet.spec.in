%define app_name @PACKAGE_TARNAME@

# conditions are set unless build command is eg. rpmbuild -bb --withhout-mate â€¦ 
%bcond_without mate
%bcond_without xfce4

Name:    %{app_name}-applet
Version: @VERSION@
Release: 1%{?dist}
Summary: Bubbling Load Monitor panel applet
Group:   User Interface/X
License: GPLv2+
URL:     @PACKAGE_URL@
Source:	 @PACKAGE_URL@/archive/%{app_name}-%{version}.tar.gz

BuildRequires:	gettext
BuildRequires:	intltool
BuildRequires:	pkgconfig(glib-2.0) >= 2.0.0
BuildRequires:	pkgconfig(libgtop-2.0) >= 2.0.0

%define common_description The Bubbling Load Monitor displays CPU and memory load as a bubbling liquid. \
\
- The water level indicates how much memory is in use.\
- The color of the liquid indicates how much swap space is used (watery blue\
  means none and angry red means all).\
- The system CPU load is indicated by bubbles floating up through the liquid;\
  lots of bubbles mean high CPU load. On SMP systems CPU load distribution is\
  visualized by having the most heavily loaded CPU's bubbles in the middle and\
  the others nearer to the edges.\
- Seaweed growing up from the bottom indicate IO load; taller means high load.\
- If you have unread mail, a message in a bottle falls into the water.\
\
Choose "Add to Panel" -> "Bubbling Load Monitor" in your panel.

%description
%common_description


%define mate_package_name	mate-%{app_name}-applet
%define xfce4_package_name	xfce4-%{app_name}-plugin

%prep
%setup -q -n %{app_name}-%{version}
%{?with_mate:	%{__cp} -Rp . ../%{mate_package_name}}
%{?with_xfce4:	%{__cp} -Rp . ../%{xfce4_package_name}}


%build
%if %{with mate}
(cd ../%{mate_package_name} &&\
 %configure --with-panel=mate &&\
 %__make %{?_smp_mflags})
%endif
%if %{with xfce4}
(cd ../%{xfce4_package_name} &&\
 %configure --with-panel=xfce4 &&\
 %__make %{?_smp_mflags})
%endif


%install
%if %{with mate}
(cd ../%{mate_package_name} &&\
 %__make install DESTDIR=%{buildroot} INSTALL="install -p" &&\
 %find_lang %{app_name})
%endif
%if %{with xfce4}
(cd ../%{xfce4_package_name} &&\
 %__make install DESTDIR=%{buildroot} INSTALL="install -p" &&\
 %find_lang %{app_name})
%endif


%posttrans
%{_bindir}/gtk-update-icon-cache -q %{_datadir}/icons/hicolor &>/dev/null || :


%clean
%__rm -rf %{buildroot}


%if %{with mate}

%package -n %{mate_package_name}
Summary:       Bubblemon mate panel applet

BuildRequires:	mate-panel-devel
BuildRequires:	pkgconfig(dbus-1)
BuildRequires:	pkgconfig(libmatepanelapplet-4.0) >= 1.4.0
Requires:	mate-panel

%description -n %{mate_package_name}
%common_description

%files -n %{mate_package_name} -f ../%{mate_package_name}/%{app_name}.lang
%defattr(-,root,root,-)
%define mate_program mate-%{app_name}-applet
%{_libexecdir}/%{mate_program}
%{_datadir}/dbus-1/services/org.mate.panel.applet.BubblemonAppletFactory.service
%{_datadir}/mate-panel/applets/org.mate.panel.BubblemonApplet.mate-panel-applet
%{_datadir}/@PACKAGE@/ui/%{app_name}-menu.xml
%{_datadir}/icons/hicolor/*/*/*
%doc AUTHORS ChangeLog COPYING FAQ PROFILING README.md TODO TRANSLATIONS
%{_mandir}/man1/%{mate_program}.1.gz
%lang(hu) %{_mandir}/hu/man1/%{mate_program}.1.gz
%lang(sv) %{_mandir}/sv/man1/%{mate_program}.1.gz

%endif


%if %{with xfce4}

%package -n %{xfce4_package_name}
Summary:       Bubblemon xfce4 panel plugin

BuildRequires:	libxfce4ui-devel >= 4
BuildRequires:	xfce4-panel-devel >= 4
BuildRequires:	pkgconfig(libxfce4panel-1.0) > 4.7
BuildRequires:	pkgconfig(libxfce4ui-1) > 4.7
Requires:	xfce4-panel

%description -n %{xfce4_package_name}
%common_description

%files -n %{xfce4_package_name} -f ../%{xfce4_package_name}/%{app_name}.lang
%defattr(-,root,root,-)
%define xfce4_program %{app_name}-plugin
%{_libdir}/xfce4/panel/plugins/%{xfce4_program}
%{_datadir}/xfce4/panel/plugins/%{app_name}.desktop
%{_datadir}/icons/hicolor/*/*/*
%doc AUTHORS ChangeLog COPYING FAQ PROFILING README.md TODO TRANSLATIONS
%{_mandir}/man1/%{xfce4_program}.1.gz
%lang(hu) %{_mandir}/hu/man1/%{xfce4_program}.1.gz
%lang(sv) %{_mandir}/sv/man1/%{xfce4_program}.1.gz

%endif


%changelog
* Mon Oct 20 2014 Honore Doktorr <hdfssk@gmail.com> - 3.0-1
- Upgraded to 3.0, for Mate & XFCE4 panel support.

* Thu Dec 24 2009 Edwin ten Brink <fedora at tenbrink-bekkers.nl> - 2.0.15-1
- Upgraded to 2.0.15, which fixes a crash which occurs in some locales.

* Fri Jul 24 2009 Fedora Release Engineering <rel-eng@lists.fedoraproject.org> - 2.0.14-2
- Rebuilt for https://fedoraproject.org/wiki/Fedora_12_Mass_Rebuild

* Mon May 11 2009 Edwin ten Brink <edwin.ten.brink at gmail.com> - 2.0.14-1
- Upgraded to version 2.0.14.

* Sat Apr 25 2009 Edwin ten Brink <edwin.ten.brink at gmail.com> - 2.0.13-3
- Incorporated following suggestions from Fedora package review process:
  Changed name to gnome-applet-bubblemon. Changed license to GPLv2+.
  Removed AutoReqProv. Added Requires: gnome-panel. Removed doc ABOUT-NLS.
  Modified make install to preserve timestamps.

* Tue Apr 21 2009 Edwin ten Brink <edwin.ten.brink at gmail.com> - 2.0.13-2
- Added seaweeds to description. Added ABOUT-NLS to documentation.
  Fine-tuned BuildRequires (removed packages which were also included via
  dependencies in the mentioned BuildRequires).

* Sun Apr 19 2009 Edwin ten Brink <edwin.ten.brink at gmail.com> - 2.0.13-1
- Converted to use Fedora packaging guidelines and additional clean-up for
  submission into Fedora. Updated description. Removed the (now obsoleted)
  French translations. Updated BuildRequires to reflect reality.

* Thu Jul 10 2008 Edwin ten Brink <edwin.ten.brink at gmail.com> - 2.0.9
- Changed to newer RPM format: Copyright -> License, removed old bug
  work-around for install, fixed name and version macro's, changed
  Requires: from libgtop -> Automatic Dependencies, added clean-up of
  the build root, fixed man page locations.

* Mon Mar 03 2003 Eric Lassauge <lassauge at mail.dotcom.fr>
- Added french translations
,
